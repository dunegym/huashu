# 2025华数杯C题代码仓

## 项目结构

algorithm存放算法思路，src存放源码

## 第一问

### 相关色温

##### 进展

调库函数成功得到1931年2度标准下的三刺激值(1358.89981656，1333.19518081，846.29717752)、色品坐标(0.38404443，0.37677994)

已实现两种算法：

用McCamy近似公式法得到相关色温为3903.1788513707074

~~用三角垂足插值法（日光轨迹近似）得到相关色温为4040.270797329553~~  直接用黑体轨迹则得到相关色温为3940.985186942354

~~误差大于%3，可能存在隐患~~  已解决

放弃文献1中提到的日光轨迹方程，转而使用普朗克公式直接推算黑体轨迹，成功将误差压缩至%1以内；正如文献1中所说，日光轨迹近似仅限5000K以上，但其公式却将下限取到了4000K，具有一定的误导性

尝试使用Chebyshev法，但计算结果超过10000，误差极大，仍在排查

转成1976标准uv色度图后计算Duv，顺便再次应用三角垂足插值法得到相关色温3921.7166255522325

##### 搁置

Chebyshev法和模拟黑体轨迹法暂时搁置，有空再做

### 色偏差

转成1976标准uv色度图后，坐标(0.22747168  0.50212997)，得到最短距离点(0.22655459434111991, 0.50304744205681362)，最短距离Duv = 0.001297，远小于CIE规定的0.054，故可以推知该LED光源近似黑体，之前对色温的近似计算是合理的

### 保真度指数和色域指数

按照TM-30标准，将目标光源转换到CAM02-UCS颜色空间中。生成99个CES样本进行测试，结果如下：

```
=== TM-30 颜色质量评估 ===
保真度指数 (Rf): 78.22109435877833
色域指数 (Rg): 106.04682167430472
有效颜色样本数: 99
平均色差: 3.2360929630344235
使用的色调箱数: 13
颜色保真度评价: 良好
色域评价: 理想色域
```

### 褪黑素日光照度比

依次计算mel-opic辐照度、照度、mel-opic光效、D65日光的对应数据，最终得到结果

```
=== 褪黑素日光照度比（mel-DER）计算 === 
褪黑素日光照度比 (mel-DER): 0.5328
测试光源mel-opic辐照度: 0.490585 W/m²     
测试光源照度: 1085.16 lux
测试光源mel-opic ELR: 0.00045209 W/m²/lux 
D65 mel-opic ELR: 0.00084843 W/m²/lux     
mel-DER评估: 相比D65日光，该光源对melanopsin的刺激较弱，可能更适合晚间使用
```

## 第二问

### 进展

简化版代码q2_basic.py，使用SLSQP（序列最小二乘规划）方法，采用罚函数法处理约束条件，各参数的计算均采用近似策略。

```
加载数据...
警告：无法加载CIE色样，使用模拟色样: 找不到色样数据
数据加载成功
优化日间照明模式...
  开始日间模式优化...
  日间模式优化完成
优化夜间助眠模式...
  开始夜间模式优化...
  夜间模式优化完成

===== 场景一：日间照明模式 =====
最优权重 [B, G, R, WW, CW]: [0.2828, 0.1358, 0.1138, 0.028199999999999999, 0.43940000000000001]
相关色温 (CCT): 6372.1 K
色偏 (Duv): 0.000 ×10⁻³
保真度指数 (Rf): 100.0
色域指数 (Rg): 100.0
褪黑素日光照度比 (mel-DER): 0.121

===== 场景二：夜间助眠模式 =====
最优权重 [B, G, R, WW, CW]: [0.72570000000000001, 0.01, 0.24429999999999999, 0.01, 0.01] 
相关色温 (CCT): 2500.7 K
色偏 (Duv): 0.000 ×10⁻³
保真度指数 (Rf): 93.9
色域指数 (Rg): 98.8
褪黑素日光照度比 (mel-DER): 0.018
```

### 搁置

精确计算版代码（差分进化算法、粒子群算法、神经网络）验证周期过长，暂时放弃。

## 第三问

### 进展

已解决：
多约束优化问题：既要保证光谱相似度，又要满足色温范围和色彩还原性要求
数据处理鲁棒性：能够处理不同格式的光谱数据，并提供备选方案
生物节律评估：集成了melanopic效能函数来评估对人体昼夜节律的影响

```运行结果
1. 数据准备中...
2. 计算目标CCT...
3. 优化LED权重...
  优化时间点 1/15...
  优化时间点 2/15...
  优化时间点 3/15...
  优化时间点 4/15...
  优化时间点 5/15...
  优化时间点 6/15...
  优化时间点 7/15...
  优化时间点 8/15...
  优化时间点 9/15...
  优化时间点 10/15...
  优化时间点 11/15...
  优化时间点 12/15...
  优化时间点 13/15...
  优化时间点 14/15...
  优化时间点 15/15...
权重控制策略已保存至 results/led_weight_strategy.xlsx
4. 代表性时间点验证与分析...

代表性时间点参数对比表:
   时间  合成CCT (K)  目标CCT (K)  RMSE    Rf  Rg  mel-DER
 5:30    1000.29    1000.29  0.37 100.0 100     1.02
 8:60    1000.29    1000.29  0.48 100.0 100     1.26
12:30    1000.29    1000.29  0.04 100.0 100     0.08

5. 结果分析:
实际处理时间点数: 15
平均RMSE: 0.3487（光谱匹配度）
节律趋势: 早期CCT 1000K → 中期1000K → 晚期1000K
颜色还原: 最小Rf 100.0 ≥ 80，满足照明需求

求解完成！结果保存在results文件夹。
```